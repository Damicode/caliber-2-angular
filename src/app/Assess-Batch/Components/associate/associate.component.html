<div class="container">
  <!-- The max width is manually set to the same width as the original AngularJss webpage -->
  <div class="container" id="trainer-assess-table">
    <div class="row">
      <div class="col-md-12 col-lg-12 top5">
        <p class="bg-primary align center"></p>
        <ul class="nav nav-tabs">
          <p class="bg-primary align center"></p>
          <ul class="nav nav-tabs">
            <!-- Accordian table -->
            <table class="table table-responsive" style="border-collapse: collapse;">
              <thead>
                <tr sticky class="sticky-header">

                  <th class="col-sm-1 col-md-1 col-lg-1">Trainee</th>
                  <th class="col-sm-1 col-md-1 col-lg-1"></th>
                  <th class="col-sm-1 col-md-1 col-lg-1"></th>

                  <!-- Displays the category as well as the assessment information-->
                  <th data-tooltip="Click to edit" role="button" class="col-sm-1 col-md-1 col-lg-1 text-center"
                    *ngFor="let assessment of assessmentArr; let i=index" data-toggle="modal"
                    data-target="#editAssessmentModal_" (click)='selectedId(assessment)' title="Click to edit">
                    {{ category[i]?.skillCategory }}
                    {{ assessment.assessmentType }}
                    ({{ ((assessment.rawScore/totalRaw)*100) | number : '1.0-0'}}%)
                  </th>

                  <th class="col-sm-9 col-md-9 col-lg-9">Notes</th>

                </tr>
              </thead>
              <tbody>
                <!-- Displays the trainee names -->
                <tr *ngFor="let train of traineeArr; let j = index" class="NoteRow">
                  <td style="width: 11%;" class="dropup">

                    <!-- sets colored icon next above name representing trainee flagStatus -->
                    <div *ngIf="train.flagStatus == 'RED'" class="flag-note-area-red dropbtn"></div>
                    <div *ngIf="train.flagStatus == 'GREEN'" class="flag-note-area-green dropbtn"></div>
                    <div *ngIf="train.flagStatus == null" class="flag-note-area-empty dropbtn"></div>
                    
                    {{train.name}}

                    <!-- pen button/cursor object, under name -->
                    <br>
                    
                    <em (click)="onAddFlagClicked(train, j); isaddFlagClicked= true"
                      class="fas fa-pen options" style="margin: 10px 5px; color:#00000080; cursor: pointer;"
                      data-toggle="modal" attr.data-target="#{{j}}"></em>

                        <!-- dropup to display flagNotes -->
                      <div *ngIf="((train.flagNotes != '') && (train.flagStatus === 'RED' || train.flagStatus === 'GREEN'))"
                            class="dropup-content">
                            <ul>
                                <li *ngIf="train != null ">{{train.flagNotes}}</li>
                            </ul>
                        </div>


                    <!-- MODEL FOR FLAGGING STARTS -->
                    <div *ngIf="isaddFlagClicked==true" id="{{j}}" class="modal fade">
                      <div class="modal-dialog">
                        <div class="modal-content">
                          <div class="modal-body">
                            <label for="flagsStatus">Select a Flag:</label>
                            <div>
                              <ul class="nav nav-tabs">
                              

                                  <!-- clicking the colored flag buttons in the module -->
                                <li><em title="Green Flag" role="button" id="greenFlag"
                                    class="fas fa-flag fa-3x fa-green objectButton"
                                    (click)="cycleFlag3(train, 'GREEN');"></em>
                                </li>
                                <li><em title="Red Flag" role="button" id="redFlag"
                                    class="fas fa-flag fa-3x fa-red objectButton"
                                    (click)="cycleFlag3(train, 'RED');"></em>
                                </li>
                                <br>
                                <br>
                                <br>
                              </ul>
                            </div>
                            

                              <!-- adding comments and setting 'selected flag' icon in the module -->
                            <div class="form-group">
                              <label for="comment">Comment:</label>
                              <textarea class="form-control" rows="3" id="comment"
                                [(ngModel)]="train.flagNotes">{{ train.flagNotes }}</textarea>
                              <div style="margin-top: 10px;">Selected flag:
                                <em *ngIf="(flagStatusVisual) != null"
                                  class="fas fa-flag fa-1x {{flagStatusVisual}}"></em>
                              </div>
                            </div>
                          </div>
                          
                            <!-- module buttons -->
                          <div class="modal-footer">
                            <button style="float: left;" class="btn btn-primary" data-dismiss="modal"
                              *ngIf="train.flagStatus != null && train.flagStatus != 'NONE'"
                              (click)="onFlagDelete(train)">Delete</button>
                            <button class="btn btn-primary" data-dismiss="modal"
                              *ngIf="train.flagStatus != null && train.flagStatus != 'NONE'"
                              (click)="onFlagSubmit(train)">Submit</button>
                            <button class="btn btn-primary" data-dismiss="modal"
                              (click)="onFlagCancel2(train);">Cancel</button>
                          </div>
                        </div>
                      </div>
                    </div>
                    <!-- MODEL FOR FLAGGING ENDS -->

                  </td>

                  <td style="width:25px !important">   
                  </td>
                  <em>
                    <div *ngIf="flagNoteSwitch.indexOf(train.traineeId) != -1" class="flag-notes-popup">
                      <input class="form-control" type="text" placeholder={{train.flagNotes}} #comment />
                      <button (click)="commentOnTrainee(train,comment.value)"
                        class="btn btn-secondary flage-notes-save-btn">Save</button>
                      <em (click)="deleteFromSwitch(train.traineeId)" type="button"
                        class="flage-notes-close-btn icon-button" aria-label="Close">
                        <span class="glyphicon glyphicon-remove-sign closing-button"></span>
                      </em>
                    </div>
                  </em>

                  <!-- Displays the grades for each trainee by assessment -->
                  <ng-container *ngFor="let arr of superArr">
                    <ng-container *ngIf="checkForGrade(arr, train); else elseBlock">
                      <td class="text-center col-sm-1 col-md-1 col-lg-1"><input class="form-control" [id]="scoreId"
                          type="number" min="0" max="100" [value]="score" (blur)="validateScore($event)" /></td>
                    </ng-container>
                    <ng-template #elseBlock>
                      <td class="text-center col-sm-1 col-md-1 col-lg-1"><input class="form-control" type="number"
                          min="0" max="100" value="" (blur)="validateScore($event)" /></td>
                    </ng-template>
                  </ng-container>

                  <td *ngIf="noteArr.length != 0">
                      <textarea (blur)="noteOnBlur(j, false)" (keypress)="clearAllSavingIcon(j); isTyping = true"
                        (keydown.backspace)="clearAllSavingIcon(j); isTyping = true" id="note-textarea-{{j}}"
                        class="form-control" maxlength="4000" rows="3" cols="75" placeholder="Note on {{train.name}}"
                        [(ngModel)]="noteArr[j].noteContent">{{noteArr[j]?.noteContent}}</textarea>
                    </td>
                  <!-- Status icons -->
                  <div class="savingIconDiv" [attr.id]="'spinner' + j" style="display: none;">
                    <i style="color: #F26925;" class="fa fa-spinner fa-spin fa-1x" aria-hidden="true"></i>
                  </div>
                  <div class="savingIconDiv" style="display: none;" [attr.id]="'checkMark' + j">
                    <i class="fa fa-check fa-1x" aria-hidden="true"></i>
                  </div>
                  <div class="savingIconDiv" style="display: none;" [attr.id]="'errMark' + j">
                    <i class="fa fa-times fa-1x" aria-hidden="true" style="color:red;"></i>
                  </div>
                </tr>
              </tbody>
              <tfoot>
                <!-- shows the average scores for each assessment as well as weekly batch average -->
                <tr>
                  <td class="col-sm-2 col-md-2 col-lg-2">
                    <strong>Average</strong>
                  </td>
                  <td></td>
                  <td></td>
                  <td class="col-sm-1 col-md-1 col-lg-1 text-center" *ngFor="let average of avgArr">
                    {{average | number:'1.1-2' }}%
                  </td>
                  <td><strong> Weekly Batch Avg: </strong>{{ result | number:'1.1-2' }}%</td>
                </tr>
              </tfoot>
            </table>
          </ul>
        </ul>
      </div>
    </div>
  </div>
</div>

<app-update-delete-assessment-modal></app-update-delete-assessment-modal>